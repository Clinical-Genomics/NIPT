<html>
<head>


    <title>NIPT</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/1.0.8/css/sb-admin-2.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-1.5.1.min.js"></script>



</head>
<body>
    <div id="wrapper">


       <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://127.0.0.1:5000/NIPT/">Project ID</a>
            </div>
            <!-- /.navbar-header -->
    
             <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="http://127.0.0.1:5000/NIPT/"><i class="fa fa-dashboard fa-fw"></i>Project Summary</a>
                        </li>
                        <li>
                            <a href="http://127.0.0.1:5000/NIPT/{{batch_id}}/NCV_plots/"><i class="fa fa-table fa-fw"></i>NCV plots</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </div>
            </div>
        </nav>


        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Sample: <strong>{{sample_id}}</strong></h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
             <div class="row">
                <div class="col-lg-9">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                           <h5>Chromosome Abnormality Status Table</h5>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="table-responsive">

                                <form action="{{ url_for('update_trisomi_status', batch_id=batch_id, sample_id = sample_id) }}" method="post">
                                <table class="table table-striped table-bordered table-hover" >
                                    <thead>
                                        <tr>
                                            <th>Chromosome abnormality</th>
                                            <th>Status</th>
                                            <th>Latest change</th>
                                            <th>Comments</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for c in chrom_abnorm %}
                                        <tr>
                                            <td><strong>{{ c }}</strong></td>
                                            <td{% if db_entries[c] == "Suspected" %} class="warning"{% endif %}
                                                {% if db_entries[c] == "False Positive" %} class="success"{% endif %}
                                                {% if db_entries[c] == "Verified" %} class="danger"{% endif %}
                                                {% if db_entries[c] == "Probable" %} class="warning"{% endif %}
                                                {% if db_entries[c] == "False Negative" %} class="danger"{% endif %}
                                                {% if db_entries[c] == "Other" %} class="warning"{% endif %}><select  name="{{c}}" >
                                                <option {% if db_entries[c] == "Normal" %} selected {% endif %} value="Normal">Normal</option>
                                                <option {% if db_entries[c] == "Suspected" %} selected {% endif %} value="Suspected">Suspected</option>
                                                <option {% if db_entries[c] == "Probable" %} selected {% endif %} value="Probable">Probable</option>
                                                <option {% if db_entries[c] == "Verified" %} selected {% endif %} value="Verified">Verified</option>
                                                <option {% if db_entries[c] == "False Positive" %} selected {% endif %} value="False Positive">False Positive</option>
                                                <option {% if db_entries[c] == "False Negative" %} selected {% endif %} value="False Negative">False Negative</option>          
                                                <option {% if db_entries[c] == "Other" %} selected {% endif %} value="Other">Other</option>
                                                </select>
                                            </div></td>
                                            <td> {{db_entries_change[c]}} </td>
                                            <td> 
                                                <div class="form-group">
                                                    <textarea class="form-control" rows="3" name = "comment_{{c}}">{{db_entries_comments[c]}}</textarea> 
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                 </table>
                                 <table>
                                        <tr>
                                            <td>
                                                </td>
                                                    <p align="right"> 
                                                        <button type="submit" style="background-color:rgb(204, 204, 0)" class="btn" name="trisomi status" value="ff"  > Save</button>          
                                                        <!--input type="submit" class="btn btn-success" value=""-->
                                                      </p>
                                                </td>
                                            </td>
                                        </tr>
                                    </table>
                                </form>    
                            </div>
                            <!-- /.table-responsive -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                           <h5>NCV - chromosomes 13, 18 & 21</h5>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div id="plot_131821" style="min-width:450px; height:450px; "></div><br><br>
                        </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                           <h5>NCV - sex chromosomes</h5>
                        </div>
                        <div class="panel-body">
                            <div id="plot_sex" style="min-width:450px; height:450px; "></div><br><br>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-8 -->
            </div>
            <!-- /.row -->
</div>
        <!-- /#page-wrapper -->
</div>

<script>

var layout = {
    title: "Sample: {{sample.sample_ID}}",
    legend:{hovermode:'closest' },
    hovermode:'closest',
    xaxis :{showline: true,
            tickvals : [1,2,3],
            ticktext : {{NCV_131821|tojson}},
            linecolor: '#636363',
            linewidth: 5,
            showgrid: true,
            gridcolor: '#bdbdbd',
            },
            
    yaxis :{zeroline: false,
            showline: true,
            showgrid: false,
            linecolor: '#636363',
            linewidth: 5,
            title : 'NCV'
            },
};

var data = []

var i = 0
{% for chrom  in NCV_131821 %}
    var i = i + 1

    var x = []
    for (var j = 0; j < {{NCV_stat[chrom]['nr_pass']}}; j++) x[j] = i
    var box = {
            y: {{NCV_stat[chrom]['NCV_pass'][0]}},
            x: x,
            //jitter: 0.3,
            pointpos: 30,
            type: 'box',
            showlegend: false,
            marker: {
                color: 'rgba(127, 96, 0, 0.5)'},
            name: 'validation samples ({{nr_validation_samps}} pcs)',
            hoverinfo:'none',
            boxpoints: 'suspectedoutliers',
            };

    var samp = {
        y: [{{NCV_dat.__dict__[chrom]}}],
        x: [i],
        name: "{{chrom}}",
        mode: 'markers',
        type: 'scatter',
        marker: {
            size: 10}
        };


    data.push(box); 
    data.push(samp);
{% endfor %}

{% for abn  in tris_chrom_abn.keys() %} 
    var verif = {                                                                  
            name: "Verified",                                                               
            y: {{tris_chrom_abn[abn]['Verified']['NCV']}},                                        
            x: {{tris_chrom_abn[abn]['Verified']['x_axis']}},
            text: {{tris_chrom_abn[abn]['Verified']['s_name']|tojson}},                                       
        mode: 'markers',
        marker: {symbol :"square",
                size: 10,
                 //color : "rgb(0, 255, 255)"
                } ,                                                   
        type: 'scatter',                                                            
        }; 

    var prob = {                                                                  
            name: 'Probable',                                                               
            y: {{tris_chrom_abn[abn]['Probable']['NCV']}},                                        
            x: {{tris_chrom_abn[abn]['Probable']['x_axis']}},
            text: {{tris_chrom_abn[abn]['Probable']['s_name']|tojson}},                                                           
        mode: 'markers',  
        marker: {symbol : "triangle-up",
                size: 10,
                 //color : "rgb(255, 0, 255)"
                },                                                          
        type: 'scatter',                                                            
        };   

    var false_neg = {                                                                  
            name: 'False Negative',                                                               
            y: {{tris_chrom_abn[abn]['False Negative']['NCV']}},                                        
            x: {{tris_chrom_abn[abn]['False Negative']['x_axis']}},
            text: {{tris_chrom_abn[abn]['False Negative']['s_name']|tojson}},                                                           
        mode: 'markers',  
        marker: {symbol : "triangle-up",
                size: 10,
                 //color : "rgb(255, 0, 255)"
                },                                                          
        type: 'scatter',                                                            
        }; 

    var false_pos = {                                                                  
            name: 'False Positive',                                                               
            y: {{tris_chrom_abn[abn]['False Positive']['NCV']}},                                        
            x: {{tris_chrom_abn[abn]['False Positive']['x_axis']}},
            text: {{tris_chrom_abn[abn]['False Positive']['s_name']|tojson}},                                                           
        mode: 'markers',  
        marker: {symbol : "triangle-up",
                size: 10,
                 //color : "rgb(255, 0, 255)"
                },                                                          
        type: 'scatter',                                                            
        }; 



    data.push(prob);
    data.push(verif);
    data.push(false_neg);
    data.push(false_pos);
{% endfor %}


{% for line  in tris_thresholds.keys() %} 
var line = {x : [0.5, 3.5],
            y : [{{tris_thresholds[line]['NCV']}},{{tris_thresholds[line]['NCV']}}],
            mode: 'lines',
            showlegend: false,
            line: {
                dash: 'dot',
                color : "{{tris_thresholds[line]['color']}}",
                width : 2},
            name: "{{line}}"};
data.push(line);
{% endfor %}


Plotly.newPlot('plot_131821',data,  layout);
</script>

<script>
var data = []
var layout = {
    title: "Sample: {{sample.sample_ID}}",
    legend:{hovermode:'closest' },
    hovermode:'closest',
    xaxis :{zeroline: false,
            showline: true,
            linecolor: '#636363',
            showgrid: false,
            linewidth: 5,
            title : 'NCV_X'
            },
            
    yaxis :{zeroline: false,
            showline: true,
            showgrid: false,
            linecolor: '#636363',
            linewidth: 5,
            title : 'NCV_Y'
            },
};

{% for line  in sex_tresholds %} 
var line = {x : {{sex_tresholds[line]['x']}},
            y : {{sex_tresholds[line]['y']}},
            mode: 'lines',
            line: {
                dash: 'dot',
                color : 'red',
                width : 2},
            showlegend: false,
            name: "{{line}}"};
data.push(line);
{% endfor %}

var backstat = {
    y: {{NCV_stat['NCV_Y']['NCV_pass'][0]}},
    x: {{NCV_stat['NCV_X']['NCV_pass'][0]}},
    name: 'validation samples ({{nr_validation_samps}} pcs)',
//    hoverinfo:'none',
    mode: 'markers',
    type: 'scatter',
    marker: {color: 'rgba(127, 96, 0, 0.5)'},
            size: 10
            }
data.push(backstat);

{% for abn  in sex_chrom_abn.keys() %} 
    var verif = {                                                                  
            name: '{{abn}}',                                                               
            y: {{sex_chrom_abn[abn]['Verified']['NCV_Y']}},                                        
            x: {{sex_chrom_abn[abn]['Verified']['NCV_X']}},
            text: {{sex_chrom_abn[abn]['Verified']['s_name']|tojson}},                                       
        mode: 'markers',
        marker: {symbol :"square",
                size: 10,
                 //color : "rgb(0, 255, 255)"
                } ,                                                   
        type: 'scatter',                                                            
        }; 
    data.push(verif);
{% endfor %}

var sample_XY = {
    y: [{{NCV_dat.NCV_Y}}],
    x: [{{NCV_dat.NCV_X}}],
    name: 'Sample {{sample.sample_ID}}',
    mode: 'markers',
    type: 'scatter',
    marker: {size: 10}
        };
data.push(sample_XY);

Plotly.newPlot('plot_sex',data,  layout);
</script>
</body>
</html>

