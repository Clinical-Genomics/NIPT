<html>
<head>



    <title>NIPT</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/1.0.8/css/sb-admin-2.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/tabletools/2.2.2/css/dataTables.tableTools.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.1.2/css/buttons.bootstrap.min.css">
<style>
/* tab color */
.nav-tabs>li>a {
  text-color:orange;
  ;
}

/* active tab color */
.nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
  color: #fff;
  background-color: #666;
  border: 1px solid #666;
}

/* hover tab color */
.nav-tabs>li>a:hover {
  border-color: #666;
  background-color: #888888;
}
</style>
</head>
<body>
    <div id="wrapper">
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <a class="navbar-brand" href="{{ url_for('batch')}}" >Back to NIPT Batches</a>
            </div>
            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="navbar-brand" data-toggle="dropdown">
                        <i class="fa fa-align-justify fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu">
                    <a class="active" href="{{ url_for('batch') }}"><i class="fa fa-home"></i> Start</a>
                    <li class="divider"></li>
                    <a class="active" href={{ url_for('statistics') }}><i class="fa fa-bar-chart"></i>  Statistics</a>
                    <li class="divider"></li>
                    <a class="active" href={{ url_for('samples') }}><i class="fa fa-table"></i>  Sample List</a>
                    <li class="divider"></li>
                    <a class="active" href={{"https://github.com/Clinical-Genomics/NIPT/issues/new"}}><i class="fa fa-comment-o"></i>  Issues</a>
                    <li class="divider"></li>
                    <a class="active" href={{ url_for('logout') }}><i class="fa fa-sign-out"></i>  Sign Out</a>
                    <li class="divider"></li>
                    <a class="active" href={{ url_for('submit') }}><i class="fa fa-user"></i>  New User</a>
                    <li class="divider"></li>
                    <a class="active" href={{ url_for('download') }}><i class="fa fa-arrow-down"></i>  Download DB</a>
                    </ul>
                </li>
            </ul>
            <div class="navbar-right">
                <a class="navbar-brand">{{current_user.name}}</a>
            </div>
        </nav>
        <div class="container-fluid">
            <div class="jumbotron vertical-center">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">Batch: {{batch_name}}</h1>
                        <h1><small><em> Sequenced {{seq_date}}</em></small></h1>
                        <p align="right">
                        <a href={{ url_for('report', batch_id=batch_id) }}> Batch Report</a>
                        </p>
                    </div>
                </div>
                {% if seq_warnings %}
                <div class="row">
                    <div id = "custom-tag"> </div>
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h5>Batch Warnings </h5>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                            <th>Sample id</th>
                                            <th><a href="#" data-toggle="tooltip" data-placement="bottom" title="Warning if NonExcludedSites < 8000000.">Missing data</a></th>
                                            <th>QC Warning</th>
                                            <th>QC Failure</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for s in seq_warnings %}
                                            <tr>
                                            <td> <a href={{ url_for('sample_page', sample_id=s) }}>{{ s }}</a></td>
                                            <td>{{seq_warnings[s]['missing_data'] }}</td>
                                            <td>{{ seq_warnings[s]['QC_warn'] }}</td>
                                            <td>{{ seq_warnings[s]['QC_fail'] }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div> <!--jumbotron-->
            <ul class="nav nav-tabs" id="myTab">
                                <li><a href="{{url_for('sample', batch_id = batch_id)}}">NCV Table</a>
                                </li>
                                <li><a href="{{url_for('NCV13_plot', batch_id = batch_id)}}" >NCV13</a>
                                </li>
                                <li><a href="{{url_for('NCV18_plot', batch_id = batch_id)}}">NCV18</a>
                                </li>
                                <li><a href="{{url_for('NCV21_plot', batch_id = batch_id)}}">NCV21</a>
                                </li>
                                <li class="active"><a href="{{url_for('NCVXY_plot', batch_id = batch_id)}}">NCVXY</a>
                                </li>
                                {% if bool_warns %}
                                <li><a href="{{url_for('coverage_plot', batch_id = batch_id)}}">Coverage (Chr 1-22)</a>
                                </li>
                                {% endif %}
            </ul>
            <div class="tab-content">
            <div class="tab-pane active" id='NCV_XY'>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div id="NCVXY" style="min-width:400px; height:800px; ">
                        </div>
                            <div align="right" style="margin-right: 2.0cm;">
                                <table width="300">
                                    <tr height="1" style="border-bottom: 1px solid black">
                                        <td><strong><p style="font-size:12px">Class</font></strong></td>
                                        <td><strong><p style="font-size:12px">XXX</p></strong></td>
                                        <td><strong><p style="font-size:12px">XYY</p></strong></td>
                                        <td><strong><p style="font-size:12px">XXY</p></strong></td>
                                        <td><strong><p style="font-size:12px">X0</p></strong></td>
                                    </tr>
                                    {% for abn in ncv_abn_colors.keys() %}
                                    <tr height="0,5">
                                        <td><p style="font-size:12px"><font color="{{ncv_abn_colors[abn]}}"><strong>{{abn}}</strong></font></p></td>
                                        <td><p style="font-size:12px">{{sex_chrom_abn["XXX"][abn]['nr_cases']}}</p></td>
                                        <td><p style="font-size:12px">{{sex_chrom_abn["XYY"][abn]['nr_cases']}}</p></td>
                                        <td><p style="font-size:12px">{{sex_chrom_abn["XXY"][abn]['nr_cases']}}</p></td>
                                        <td><p style="font-size:12px">{{sex_chrom_abn["X0"][abn]['nr_cases']}}</p></td>
                                    </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!--tab-conten-->
        </div> <!--container-->
    </div>  <!--wrapper-->
<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="https://cdn.plot.ly/plotly-1.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.1.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.colVis.min.js"></script>


<script>
    var XY_plot = document.getElementById('NCVXY')
    var data = []
    var layout = {
    annotations : [],
    title: 'X vs Y',
    legend:{hovermode:'closest' },
    hovermode:'closest',
    xaxis :{showline: true,
            zeroline: false,
            linecolor: '#636363',
            linewidth: 5,
            showgrid: false,
            gridcolor: '#bdbdbd',
            title: 'NCVX'
            },
            
    yaxis :{range: [-50,],
            zeroline: false,
            showline: true,
            showgrid: false,
            linecolor: '#636363',
            linewidth: 5,
            title : 'NCVY'
            },};
    var backstat = {
    y: {{NCV_stat['NCV_Y']['NCV_pass'][0]}},
    x: {{NCV_stat['NCV_X']['NCV_pass'][0]}},
    text: {{NCV_stat['NCV_X']['NCV_pass_names'][0]|tojson}},
    name: 'Negative (N={{NCV_stat['NCV_Y']['nr_pass']}})',
    hoverinfo:'none',
    mode: 'markers',
    type: 'scatter',
    marker: {color: '#ccccb3'}}
    data.push(backstat);
    var i = 0

    {% for abn  in sex_chrom_abn.keys() %} 
    {% for abn_status  in abn_status_list %} 
    var verif = {                                                                  
            name: '{{abn}} {{abn_status}} (N={{sex_chrom_abn[abn][abn_status]['nr_cases']}})',                                                               
            y: {{sex_chrom_abn[abn][abn_status]['NCV_Y']}},                                        
            x: {{sex_chrom_abn[abn][abn_status]['NCV_X']}},
            text: {{sex_chrom_abn[abn][abn_status]['s_name']|tojson}},                                       
        mode: 'markers',
        marker: {   size: {{abn_size}},
                    symbol :"square",
                    color: "{{ncv_abn_colors[abn_status]}}"} ,                                                   
                    type: 'scatter'              
                }; 
    data.push(verif);
    var i = i +1
    {% endfor %}
    {% endfor %}

    {% for line  in sex_tresholds %} 
        layout["annotations"].push({
            x: {{sex_tresholds[line]['text_position'][0]}},
            y: {{sex_tresholds[line]['text_position'][1]}},
            xref: 'x',
            yref: 'y',
            text: "{{sex_tresholds[line]['text']}}",
            showarrow: true,
            xanchor:'left',
            arrowcolor:'red',
            arrowwidth: 0.5,
            arrowhead: 0.5,
            opacity : 0.5,
            ax: -50,
            ay: 30,
            font: {
                color: 'red',
                family: 'Courier New, monospace',
                size: 15
             }})
        var line = {
            x : {{sex_tresholds[line]['x']}},
            y : {{sex_tresholds[line]['y']}},
            mode: 'lines',
            showlegend: false,
            line: {
                dash: 'dot',
                color : 'red',
                width : 2},
            name: "{{line}}"};
    data.push(line);
    {% endfor %}
    {% for i in samp_range %}
    var trace1 = {
    y: [{{NCV_stat['NCV_Y']['NCV_cases'][i]}}],
    x: [{{NCV_stat['NCV_X']['NCV_cases'][i]}}],
    name: {{NCV_stat['NCV_X']['X_labels'][i]|tojson}},
    mode: 'markers',
    text: {{NCV_stat['NCV_X']['X_labels'][i]|tojson}},
    type: 'scatter',
    marker: {
            color: '{{many_colors[i]}}',
            size: {{case_size}}
            }};
    data.push(trace1);
    {% endfor %}

    var trace = {
    x: [-15, 0, 8, -20, -8, 0],
    y: [-50, -50, -50, 300, 300, 300],
    mode: 'text',
    name: 'NCV Clasifications',
    text: ['<b>X0</b>', '<b>XX</b>', '<b>XXX</b>','<b>XY</b>','<b>XYY</b>','<b>XXY</b>'],
    hoverinfo:'none',
    opacity : 0.7,
    textposition: 'top',
    showlegend: false,
    textfont: {
    size: 18,
    },
    type: 'scatter'
    };

    data.push(trace);
    Plotly.newPlot('NCVXY', data, layout);
    //XY_plot.on('plotly_click', function(verif){
    // var pts = '';
    // for(var i=0; i<verif.points.length; i++){
    //      pts=verif.points[i].data.name
    //   }
    //    alert(pts);
    //window.location.href = 'http://127.0.0.1:5000/NIPT/samples/'+pt;
    //});
</script>


<script>
    $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();   
    });
</script>

<script>
    jQuery(function () {
    jQuery('#myTab a:first').tab('show')
    })
</script>

<script>
    $(document).ready(function() {
    var table = $('#batch_table').DataTable( {
        lengthChange: false,
        buttons:    [ 'excel', 'pdf' ],
        paging:     false,
        info: false,
        searching:  false
    } );
    table.buttons().container()
        .appendTo( '#batch_table_wrapper .col-sm-6:eq(0)' );
} );
</script>
</body>
</html>



